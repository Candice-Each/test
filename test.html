<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operations & Maintenance Dashboard</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <style>
        :root {
            --primary-color: #1a3c6e;
            --secondary-color: #3498db;
            --accent-color: #2980b9;
            --light-bg: #f5f9fa;
            --dark-text: #333;
            --light-text: #fff;
            --sidebar-width: 70px;
            --chart-blue: #1a3c6e;
            --chart-light-blue: #3498db;
            --chart-teal: #2980b9;
            --chart-dark-teal: #1c6ea4;
            --chart-light-teal: #4da8da;
            --chart-gray: #90a4ae;
            --chart-green: #8aa46d;
            --chart-yellow: #ecbc6f;
            --chart-red: rgb(231, 127, 127);
            --border-radius: 8px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f9f9f9;
            color: var(--dark-text);
            overflow-x: hidden;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--primary-color);
            color: var(--light-text);
            padding: 20px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
        }

        .logo {
            padding: 0 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
            text-align: center;
        }

        .logo i {
            font-size: 28px;
        }

        .nav-links {
            list-style: none;
        }

        .nav-links li {
            padding: 15px;
            text-align: center;
        }

        .nav-links li.active {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .nav-links a {
            color: var(--light-text);
            text-decoration: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 12px;
        }

        .nav-links i {
            font-size: 20px;
            margin-bottom: 5px;
        }

        .nav-links span {
            display: none;
        }

        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .header-left {
            flex: 1;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .notification-bell {
            position: relative;
            font-size: 20px;
            color: #666;
            cursor: pointer;
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--chart-red);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .date-display {
            font-size: 16px;
            color: #666;
        }

        .section {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            padding: 20px;
            margin-bottom: 30px;
        }

        .section-title {
            margin-bottom: 20px;
            color: var(--primary-color);
            font-size: 20px;
            font-weight: 600;
        }

        .map-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .region-selector {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .region-selector label {
            font-weight: 600;
            color: var(--primary-color);
        }

        .region-selector select {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: white;
            min-width: 200px;
        }

        .date-selector {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .date-selector label {
            font-weight: 600;
            color: var(--primary-color);
            white-space: nowrap;
        }

        .date-selector input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: white;
            width: 150px;
        }

        .selected-info {
            font-weight: 600;
            color: var(--primary-color);
        }

        .map-container {
            display: flex;
            gap: 20px;
            width: 100%;
        }

        .map {
            flex: 7;
            height: 500px;
            background-color: #e9f5e9;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            min-width: 300px;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        .building-list {
            flex: 3;
            background-color: var(--light-bg);
            border-radius: 8px;
            padding: 20px;
            overflow-y: auto;
            max-height: 500px;
            min-width: 250px;
        }

        .data-title {
            margin-bottom: 15px;
            font-weight: 600;
            color: var(--primary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .building-item {
            display: flex;
            align-items: center;
            padding: 8px 10px;
            background-color: white;
            border-radius: 6px;
            margin-bottom: 6px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            transition: background-color 0.2s;
            cursor: pointer;
        }

        .building-item.selected {
            background-color: #e6f2ff;
            border-left: 4px solid var(--secondary-color);
        }

        .building-checkbox {
            margin-right: 10px;
            transform: scale(1.1);
        }

        .building-info {
            flex: 1;
        }

        .building-name {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 2px;
            color: var(--primary-color);
        }

        .building-location {
            font-size: 12px;
            color: #666;
        }

        .operations-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            cursor: move;
            transition: transform 0.2s, box-shadow 0.2s;
            user-select: none;
            position: relative;
        }

        .card h3 {
            margin-bottom: 15px;
            color: var(--dark-text);
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card h3 i {
            font-size: 18px;
            color: var(--primary-color);
        }

        .metric-large {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .metric-change {
            font-size: 14px;
            display: flex;
            align-items: center;
        }

        .positive {
            color: var(--chart-green);
        }

        .negative {
            color: var(--chart-red);
        }

        .top-charts-row {
            display: grid;
            grid-template-columns: 1.2fr 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .bottom-charts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        .chart-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            cursor: move;
            transition: transform 0.2s, box-shadow 0.2s;
            user-select: none;
            position: relative;
        }

        .chart-title {
            margin-bottom: 15px;
            font-size: 16px;
            color: var(--dark-text);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chart-title i {
            font-size: 18px;
            color: var(--primary-color);
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        .compact-chart-container {
            position: relative;
            height: 220px;
        }

        .expiring-leases {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }

        .lease-item {
            text-align: center;
            flex: 1;
            padding: 0 5px;
        }

        .lease-value {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--primary-color);
        }

        .lease-label {
            font-size: 11px;
            color: #666;
            line-height: 1.2;
        }

        .property-bar-container {
            margin-top: 20px;
        }

        .property-bar {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .property-bar-label {
            width: 150px;
            font-weight: 500;
            font-size: 14px;
        }

        .property-bar-values {
            width: 80px;
            text-align: right;
            font-size: 14px;
            margin-left: 10px;
        }

        .property-bar-chart {
            flex: 1;
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }

        .property-bar-fill {
            height: 100%;
            background-color: var(--chart-teal);
            border-radius: 10px;
        }

        .semi-doughnut-container {
            position: relative;
            width: 100%;
            height: 160px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .semi-doughnut-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .semi-doughnut-center-value {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .semi-doughnut-center-label {
            font-size: 12px;
            color: #666;
        }

        .nps-gauge-container {
            position: relative;
            width: 100%;
            height: 160px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .nps-gauge-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .nps-gauge-center-value {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .nps-gauge-center-label {
            font-size: 12px;
            color: #666;
        }

        .top-right-cards {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .top-right-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            cursor: move;
            position: relative;
        }

        .utilities-energy-section {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .utilities-chart {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            cursor: move;
            position: relative;
        }

        .energy-cards {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .energy-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            cursor: move;
            position: relative;
        }

        .energy-title {
            font-size: 16px;
            color: #666;
            margin-bottom: 10px;
        }

        .energy-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .energy-subvalue {
            font-size: 14px;
            color: #888;
        }

        .table-container {
            margin-top: 20px;
            overflow-x: auto;
            width: 100%;
        }

        .lease-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            table-layout: fixed;
        }

        .lease-table th,
        .lease-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .lease-table th {
            background-color: var(--light-bg);
            color: var(--primary-color);
            font-weight: 600;
        }

        .lease-table tr:hover {
            background-color: #f9f9f9;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .btn-options {
            background-color: var(--chart-light-teal);
            color: white;
        }

        .btn-details {
            background-color: var(--chart-teal);
            color: white;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
            gap: 10px;
        }

        .pagination button {
            padding: 6px 12px;
            border: 1px solid #ddd;
            background-color: white;
            color: var(--primary-color);
            border-radius: 4px;
            cursor: pointer;
        }

        .pagination button.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .pagination button:hover:not(:disabled) {
            background-color: #f1f1f1;
        }

        .pagination button:disabled {
            color: #ccc;
            cursor: not-allowed;
        }

        .sortable-ghost {
            opacity: 0.4;
            background-color: rgba(26, 60, 110, 0.1);
        }

        .sortable-drag {
            opacity: 0.8;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transform: rotate(5deg);
        }

        .operations-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .drag-instructions {
            background-color: rgba(26, 60, 110, 0.05);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary-color);
        }

        .drag-instructions h4 {
            color: var(--primary-color);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .drag-instructions p {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }

        .card:hover,
        .chart-card:hover,
        .top-right-card:hover,
        .utilities-chart:hover,
        .energy-card:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15) !important;
        }

        .fade-out {
            animation: fadeOut 2s ease-in-out forwards;
        }

        @keyframes fadeOut {
            0% { opacity: 1; }
            100% { opacity: 0; }
        }

        .add-chart-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            transition: background-color 0.2s;
        }
        
        .add-chart-btn:hover {
            background-color: var(--accent-color);
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal {
            background-color: white;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transform: translateY(-20px);
            transition: transform 0.3s;
        }
        
        .modal-overlay.active .modal {
            transform: translateY(0);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .modal-title {
            font-size: 20px;
            color: var(--primary-color);
            margin: 0;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }
        
        .chart-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .chart-option {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .chart-option:hover {
            border-color: var(--primary-color);
            background-color: rgba(26, 60, 110, 0.05);
        }
        
        .chart-option.selected {
            border-color: var(--primary-color);
            background-color: rgba(26, 60, 110, 0.1);
        }
        
        .chart-icon {
            font-size: 30px;
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .chart-label {
            font-weight: 600;
            color: var(--dark-text);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .btn-secondary {
            background-color: #f0f0f0;
            color: var(--dark-text);
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .chart-card .chart-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 10px;
        }
        
        .chart-card .delete-chart,
        .card .delete-chart {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 16px;
            transition: color 0.2s;
            position: absolute;
            top: 15px;
            right: 15px;
        }
        
        .chart-card .delete-chart:hover,
        .card .delete-chart:hover {
            color: var(--chart-red);
        }
        
        .custom-charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 1400px) {
            .top-charts-row {
                grid-template-columns: 1fr;
            }

            .bottom-charts-grid {
                grid-template-columns: 1fr;
            }

            .utilities-energy-section {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 992px) {
            .map-controls {
                flex-direction: column;
                align-items: flex-start;
            }

            .dashboard {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }

            .top-charts-row {
                grid-template-columns: 1fr;
            }

            .bottom-charts-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 15px;
            }

            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .header-right {
                width: 100%;
                justify-content: space-between;
            }

            .section {
                padding: 15px;
            }

            .chart-container {
                height: 250px;
            }

            .compact-chart-container {
                height: 180px;
            }
        }

        @media (max-width: 576px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
            }

            .nav-links {
                display: flex;
                justify-content: space-around;
            }

            .nav-links li {
                padding: 10px;
            }

            .main-content {
                margin-left: 0;
            }

            .map {
                height: 400px;
            }

            .building-list {
                max-height: 300px;
            }

            .dashboard {
                grid-template-columns: 1fr;
            }

            .top-charts-row {
                grid-template-columns: 1fr;
            }

            .bottom-charts-grid {
                grid-template-columns: 1fr;
            }

            .utilities-energy-section {
                grid-template-columns: 1fr;
            }

            .chart-container {
                height: 200px;
            }

            .compact-chart-container {
                height: 150px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="sidebar">
            <div class="logo">
                <i class="fas fa-leaf"></i>
            </div>
            <ul class="nav-links">
                <li class="active"><a href="#"><i class="fas fa-home"></i> <span>Dashboard</span></a></li>
                <li><a href="#"><i class="fas fa-map-marker-alt"></i> <span>Locations</span></a></li>
                <li><a href="#"><i class="fas fa-chart-line"></i> <span>Emissions</span></a></li>
                <li><a href="#"><i class="fas fa-leaf"></i> <span>Energy</span></a></li>
                <li><a href="#"><i class="fas fa-recycle"></i> <span>Waste</span></a></li>
                <li><a href="#"><i class="fas fa-bullseye"></i> <span>Targets</span></a></li>
                <li><a href="#"><i class="fas fa-cog"></i> <span>Settings</span></a></li>
            </ul>
        </div>

        <div class="main-content">
            <div class="header">
                <div class="header-left">
                    <h1>Operations & Maintenance Performance</h1>
                    <div class="date-display">November 2025</div>
                </div>
                <div class="header-right">
                    <div class="notification-bell">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge">3</span>
                    </div>
                    <div class="user-info">
                        <div class="user-avatar">JD</div>
                        <span>John Doe</span>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">Locations</h2>
                <div class="map-controls">
                    <div class="region-selector">
                        <label for="region-select">Select Region:</label>
                        <select id="region-select">
                            <option value="all">All Regions</option>
                            <option value="hongkong">Hong Kong</option>
                            <option value="mainland">Mainland China</option>
                            <option value="europe">Europe</option>
                            <option value="usa">United States</option>
                        </select>
                    </div>
                    <div class="date-selector">
                        <label for="start-date">Start Date:</label>
                        <input type="date" id="start-date" value="2023-11-12">
                        <label for="end-date">End Date:</label>
                        <input type="date" id="end-date" value="2024-11-12">
                    </div>
                    <div class="selected-info">
                        <span id="selected-count">0 buildings selected</span>
                    </div>
                </div>
                <div class="map-container">
                    <div class="map">
                        <div id="map"></div>
                    </div>
                    <div class="building-list">
                        <div class="data-title">
                            <h3>Building List</h3>
                            <span id="total-buildings">0 buildings</span>
                        </div>
                        <div id="building-list-container">
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="drag-instructions">
                    <h4><i class="fas fa-arrows-alt"></i> Drag & Drop</h4>
                    <p>Drag and drop widgets to rearrange the dashboard layout.</p>
                </div>
                
                <div style="display: flex; justify-content: flex-end; margin-bottom: 20px;">
                    <button class="add-chart-btn" id="add-chart-btn">
                        <i class="fas fa-plus"></i> Add Chart
                    </button>
                </div>
                
                <div class="operations-container" id="operations-container">
                    <div class="dashboard" id="dashboard">
                        <div class="card" id="revenue-card">
                            <h3><i class="fas fa-dollar-sign"></i> Total Revenue</h3>
                            <div class="metric-large" id="revenue-value">$0</div>
                            <div class="metric-change positive" id="revenue-change">+0% YoY</div>
                        </div>

                        <div class="card" id="profit-card">
                            <h3><i class="fas fa-chart-line"></i> Total Profit</h3>
                            <div class="metric-large" id="profit-value">$0</div>
                            <div class="metric-change positive" id="profit-change">+0 YoY</div>
                        </div>

                        <div class="card" id="nps-card">
                            <h3><i class="fas fa-star"></i> Net Promoter Score</h3>
                            <div class="nps-gauge-container">
                                <canvas id="npsGaugeChart"></canvas>
                                <div class="nps-gauge-center">
                                    <div class="nps-gauge-center-value" id="nps-value">0</div>
                                    <div class="nps-gauge-center-label">NPS Score</div>
                                </div>
                            </div>
                        </div>

                        <div class="card" id="occupancy-card">
                            <h3><i class="fas fa-bed"></i> Occupancy Rate</h3>
                            <div class="metric-large" id="occupancy-value">0%</div>
                            <div class="metric-change positive" id="occupancy-change">+0%</div>
                        </div>
                    </div>

                    <div class="top-charts-row" id="top-charts-row">
                        <div class="chart-card" id="leases-expiring-card">
                            <div class="chart-title"><i class="fas fa-calendar-times"></i> Leases are Expiring</div>
                            <div class="semi-doughnut-container">
                                <canvas id="leasesExpiringChart"></canvas>
                                <div class="semi-doughnut-center">
                                    <div class="semi-doughnut-center-value" id="leases-expiring-total">0</div>
                                    <div class="semi-doughnut-center-label">Units</div>
                                </div>
                            </div>
                            <div class="expiring-leases" id="expiring-leases">
                                <div class="lease-item">
                                    <div class="lease-value">$0</div>
                                    <div class="lease-label">&lt; 30 Days</div>
                                    <div class="lease-label">0 Units</div>
                                </div>
                                <div class="lease-item">
                                    <div class="lease-value">$0</div>
                                    <div class="lease-label">31-70 Days</div>
                                    <div class="lease-label">0 Units</div>
                                </div>
                                <div class="lease-item">
                                    <div class="lease-value">$0</div>
                                    <div class="lease-label">61-90 Days</div>
                                    <div class="lease-label">0 Units</div>
                                </div>
                            </div>
                        </div>

                        <div class="chart-card" id="renewed-card">
                            <div class="chart-title"><i class="fas fa-file-contract"></i> Number of Renewed Contracts
                            </div>
                            <div class="chart-container">
                                <canvas id="renewedChart"></canvas>
                            </div>
                        </div>

                        <div class="top-right-cards" id="top-right-cards">
                            <div class="top-right-card" id="new-leads-card">
                                <h3><i class="fas fa-users"></i> No. of New Leads</h3>
                                <div class="metric-large" id="new-leads">0</div>
                                <div class="metric-change positive" id="new-leads-change">+0 YoY</div>
                            </div>

                            <div class="top-right-card" id="lease-duration-card">
                                <h3><i class="fas fa-clock"></i> Average Lease Duration</h3>
                                <div class="metric-large" id="lease-duration">0 months</div>
                            </div>
                        </div>
                    </div>

                    <div class="custom-charts-grid" id="custom-charts-grid">
                    </div>

                    <div class="bottom-charts-grid" id="bottom-charts-grid">
                        <div class="chart-card" id="income-cost-card">
                            <div class="chart-title"><i class="fas fa-money-bill-wave"></i> Rental Income vs Operation
                                Cost
                            </div>
                            <div class="chart-container">
                                <canvas id="incomeCostChart"></canvas>
                            </div>
                        </div>

                        <div class="chart-card" id="occupancy-chart-card">
                            <div class="chart-title"><i class="fas fa-home"></i> Occupancy vs Vacancy</div>
                            <div class="chart-container">
                                <canvas id="occupancyChart"></canvas>
                            </div>
                        </div>

                        <div class="chart-card" id="rented-month-card">
                            <div class="chart-title"><i class="fas fa-chart-bar"></i> Properties Rented by Month</div>
                            <div class="chart-container">
                                <canvas id="rentedByMonthChart"></canvas>
                            </div>
                        </div>

                        <div class="chart-card" id="property-types-card">
                            <div class="chart-title"><i class="fas fa-building"></i> Properties Rented by Type</div>
                            <div class="property-bar-container" id="property-types">
                                <div class="property-bar">
                                    <div class="property-bar-label">Big Studio</div>
                                    <div class="property-bar-chart">
                                        <div class="property-bar-fill" style="width: 0%"></div>
                                    </div>
                                    <div class="property-bar-values">0/0</div>
                                </div>
                                <div class="property-bar">
                                    <div class="property-bar-label">Middle Studio</div>
                                    <div class="property-bar-chart">
                                        <div class="property-bar-fill" style="width: 0%"></div>
                                    </div>
                                    <div class="property-bar-values">0/0</div>
                                </div>
                                <div class="property-bar">
                                    <div class="property-bar-label">Smaller Studio</div>
                                    <div class="property-bar-chart">
                                        <div class="property-bar-fill" style="width: 0%"></div>
                                    </div>
                                    <div class="property-bar-values">0/0</div>
                                </div>
                                <div class="property-bar">
                                    <div class="property-bar-label">3 Bed Apartment</div>
                                    <div class="property-bar-chart">
                                        <div class="property-bar-fill" style="width: 0%"></div>
                                    </div>
                                    <div class="property-bar-values">0/0</div>
                                </div>
                                <div class="property-bar">
                                    <div class="property-bar-label">2 Bed Apartment</div>
                                    <div class="property-bar-chart">
                                        <div class="property-bar-fill" style="width: 0%"></div>
                                    </div>
                                    <div class="property-bar-values">0/0</div>
                                </div>
                                <div class="property-bar">
                                    <div class="property-bar-label">1 Bed Apartment</div>
                                    <div class="property-bar-chart">
                                        <div class="property-bar-fill" style="width: 0%"></div>
                                    </div>
                                    <div class="property-bar-values">0/0</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="utilities-energy-section" id="utilities-energy-section">
                        <div class="utilities-chart" id="utilities-chart">
                            <div class="chart-title"><i class="fas fa-tools"></i> Utilities & Services Cost</div>
                            <div class="chart-container">
                                <canvas id="utilitiesChart"></canvas>
                            </div>
                        </div>

                        <div class="energy-cards" id="energy-cards">
                            <div class="energy-card" id="energy-optimization-card">
                                <div class="energy-title">Energy Optimization by AI</div>
                                <div class="energy-value" id="energy-optimization">0 kWh</div>
                                
                            </div>

                            <div class="energy-card" id="energy-saving-card">
                                <div class="energy-title">Accumulative Energy Cost Saving</div>
                                <div class="energy-value" id="energy-saving">$ 0</div>
                            </div>
                        </div>
                    </div>
                    <div class="chart-card" id="lease-table-card">
                        <div class="chart-title"><i class="fas fa-table"></i> Lease Expiry Timeline</div>
                        <div class="table-container">
                            <table class="lease-table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Order Date</th>
                                        <th>Phone Number</th>
                                        <th>Location</th>
                                        <th>Registered</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="lease-table-body">
                                </tbody>
                            </table>

                            <div class="pagination" id="pagination-controls">
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="chart-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Add New Chart</h3>
                <button class="close-modal" id="close-modal">&times;</button>
            </div>
            <div class="chart-options">
                <div class="chart-option" data-type="bar">
                    <div class="chart-icon">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <div class="chart-label">Bar Chart</div>
                </div>
                <div class="chart-option" data-type="pie">
                    <div class="chart-icon">
                        <i class="fas fa-chart-pie"></i>
                    </div>
                    <div class="chart-label">Pie Chart</div>
                </div>
                <div class="chart-option" data-type="number">
                    <div class="chart-icon">
                        <i class="fas fa-hashtag"></i>
                    </div>
                    <div class="chart-label">Number Display</div>
                </div>
            </div>
            <div class="form-group">
                <label for="chart-title">Chart Title</label>
                <input type="text" id="chart-title" placeholder="Enter chart title">
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" id="cancel-modal">Cancel</button>
                <button class="btn-primary" id="add-chart-modal">Add Chart</button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        const regionCenters = {
            "hongkong": { center: [22.3193, 114.1694], zoom: 11 },
            "mainland": { center: [35.8617, 104.1954], zoom: 4 },
            "europe": { center: [50.1109, 10.0173], zoom: 4 },
            "usa": { center: [39.8283, -98.5795], zoom: 4 }
        };

        const buildingData = {
            // Hong Kong buildings - 3 buildings
            "building-a": {
                name: "Building A - Hong Kong A",
                location: "Central, Hong Kong",
                region: "hongkong",
                coordinates: [22.2820, 114.1584],
                energyOptimization: 1500,
                energySaving: 12144.12,
                // YoY data fields
                revenueChange: 2.031,
                profitChange: -52201,
                occupancyChange: -1.22,
                newLeadsChange: 41,
                // Operations data
                revenue: 412324,
                profit: 221324.50,
                nps: 90,
                occupancy: 92.8,
                // Rental income data
                incomeData: [380000, 370000, 390000, 400000, 410000, 420000, 430000, 440000, 430000, 420000, 410000, 400000],
                // Operation cost data
                costData: [100000, 110000, 120000, 130000, 140000, 150000, 160000, 170000, 180000, 190000, 200000, 210000],
                // Occupancy data
                occupancyData: { occupied: 93, vacant: 7 },
                // Monthly rentals
                rentedByMonth: [6, 7, 7, 7, 8, 7, 7, 7, 7, 7, 7, 7],
                availableByMonth: [1, 2, 4, 4, 3, 4, 4, 5, 4, 4, 4, 4],
                // Renewed contracts
                renewedContracts: [12, 11, 13, 14, 15, 16, 17, 18, 17, 16, 15, 14],
                // Property types
                propertyTypes: [
                    { name: "Big Studio", rented: 333, total: 341, percentage: 97.7 },
                    { name: "Middle Studio", rented: 228, total: 338, percentage: 67.5 },
                    { name: "Smaller Studio", rented: 150, total: 272, percentage: 55.1 },
                    { name: "3 Bed Apartment", rented: 339, total: 375, percentage: 90.4 },
                    { name: "2 Bed Apartment", rented: 188, total: 200, percentage: 94 },
                    { name: "1 Bed Apartment", rented: 330, total: 330, percentage: 100 }
                ],
                // Expiring leases
                expiringLeases: [
                    { value: "$124,245", label: "< 30 Days", units: 8 },
                    { value: "$245,000", label: "31-70 Days", units: 16 },
                    { value: "$321,000", label: "61-90 Days", units: 22 }
                ],
                // Expiring leases chart
                expiringLeasesChart: [
                    { value: 8, label: "< 30 Days", color: '#4da8da', cost: 124245 },
                    { value: 16, label: "31-70 Days", color: '#2980b9', cost: 245000 },
                    { value: 22, label: "61-90 Days", color: '#1c6ea4', cost: 321000 }
                ],
                newLeads: 145,
                leaseDuration: 15.6,
                // Utilities data
                utilitiesData: {
                    electricity: [4200, 4000, 4300, 4100, 4500, 4700, 4900, 5100, 4800, 4600, 4400, 4200],
                    gas: [2200, 2100, 2300, 2200, 2400, 2500, 2600, 2700, 2500, 2400, 2300, 2200],
                    water: [800, 750, 850, 800, 900, 950, 1000, 1050, 950, 900, 850, 800],
                    property: [3800, 3600, 3900, 3700, 4000, 4200, 4400, 4600, 4300, 4100, 3900, 3700]
                }
            },
            "building-b": {
                name: "Building B - Hong Kong B",
                location: "Kowloon, Hong Kong",
                region: "hongkong",
                coordinates: [22.3167, 114.1833],
                energyOptimization: 1200,
                energySaving: 9800.50,
                // YoY data fields
                revenueChange: -1.5,
                profitChange: -65000,
                occupancyChange: -3.5,
                newLeadsChange: -15,
                // Operations data
                revenue: 275000,
                profit: 125000,
                nps: 78,
                occupancy: 85.2,
                // Rental income data
                incomeData: [320000, 310000, 300000, 290000, 280000, 270000, 260000, 250000, 240000, 230000, 220000, 210000],
                // Operation cost data
                costData: [120000, 130000, 140000, 150000, 160000, 170000, 180000, 190000, 200000, 210000, 220000, 230000],
                // Occupancy data
                occupancyData: { occupied: 85, vacant: 15 },
                // Monthly rentals
                rentedByMonth: [4, 5, 5, 5, 6, 5, 5, 5, 5, 5, 5, 5],
                availableByMonth: [3, 4, 6, 6, 5, 6, 6, 7, 6, 6, 6, 6],
                // Renewed contracts
                renewedContracts: [8, 7, 9, 10, 11, 12, 13, 14, 13, 12, 11, 10],
                // Property types
                propertyTypes: [
                    { name: "Big Studio", rented: 210, total: 250, percentage: 84 },
                    { name: "Middle Studio", rented: 150, total: 220, percentage: 68.2 },
                    { name: "Smaller Studio", rented: 100, total: 180, percentage: 55.6 },
                    { name: "3 Bed Apartment", rented: 220, total: 260, percentage: 84.6 },
                    { name: "2 Bed Apartment", rented: 120, total: 150, percentage: 80 },
                    { name: "1 Bed Apartment", rented: 200, total: 200, percentage: 100 }
                ],
                // Expiring leases
                expiringLeases: [
                    { value: "$85,000", label: "< 30 Days", units: 12 },
                    { value: "$170,000", label: "31-70 Days", units: 10 },
                    { value: "$225,000", label: "61-90 Days", units: 10 }
                ],
                // Expiring leases chart
                expiringLeasesChart: [
                    { value: 12, label: "< 30 Days", color: '#4da8da', cost: 85000 },
                    { value: 10, label: "31-70 Days", color: '#2980b9', cost: 170000 },
                    { value: 10, label: "61-90 Days", color: '#1c6ea4', cost: 225000 }
                ],
                newLeads: 95,
                leaseDuration: 12.3,
                // Utilities data
                utilitiesData: {
                    electricity: [3800, 3600, 3900, 3700, 4000, 4200, 4400, 4600, 4300, 4100, 3900, 3700],
                    gas: [2000, 1900, 2100, 2000, 2200, 2300, 2400, 2500, 2300, 2200, 2100, 2000],
                    water: [700, 650, 750, 700, 800, 850, 900, 950, 850, 800, 750, 700],
                    property: [3500, 3300, 3600, 3400, 3700, 3900, 4100, 4300, 4000, 3800, 3600, 3400]
                }
            },
            "building-c": {
                name: "Building C - Hong Kong C",
                location: "Wan Chai, Hong Kong",
                region: "hongkong",
                coordinates: [22.2793, 114.1729],
                energyOptimization: 1800,
                energySaving: 14200.75,
                // YoY data fields
                revenueChange: 1.8,
                profitChange: -48000,
                occupancyChange: -0.9,
                newLeadsChange: 25,
                // Operations data
                revenue: 398000,
                profit: 215000,
                nps: 88,
                occupancy: 91.5,
                // Rental income data
                incomeData: [365000, 465000, 455000, 385000, 395000, 405000, 415000, 425000, 415000, 405000, 395000, 385000],
                // Operation cost data
                costData: [105000, 115000, 125000, 135000, 145000, 155000, 165000, 175000, 185000, 195000, 205000, 215000],
                // Occupancy data
                occupancyData: { occupied: 91, vacant: 9 },
                // Monthly rentals
                rentedByMonth: [5, 6, 6, 6, 7, 6, 6, 6, 6, 6, 6, 6],
                availableByMonth: [2, 3, 5, 5, 4, 5, 5, 6, 5, 5, 5, 5],
                // Renewed contracts
                renewedContracts: [11, 19, 22, 17, 14, 15, 16, 17, 16, 11, 9, 4],
                // Property types
                propertyTypes: [
                    { name: "Big Studio", rented: 305, total: 315, percentage: 96.8 },
                    { name: "Middle Studio", rented: 205, total: 305, percentage: 67.2 },
                    { name: "Smaller Studio", rented: 135, total: 245, percentage: 55.1 },
                    { name: "3 Bed Apartment", rented: 315, total: 345, percentage: 91.3 },
                    { name: "2 Bed Apartment", rented: 170, total: 185, percentage: 91.9 },
                    { name: "1 Bed Apartment", rented: 305, total: 305, percentage: 100 }
                ],
                // Expiring leases
                expiringLeases: [
                    { value: "$110,000", label: "< 30 Days", units: 9 },
                    { value: "$220,000", label: "31-70 Days", units: 14 },
                    { value: "$290,000", label: "61-90 Days", units: 15 }
                ],
                // Expiring leases chart
                expiringLeasesChart: [
                    { value: 9, label: "< 30 Days", color: '#4da8da', cost: 110000 },
                    { value: 14, label: "31-70 Days", color: '#2980b9', cost: 220000 },
                    { value: 15, label: "61-90 Days", color: '#1c6ea4', cost: 290000 }
                ],
                newLeads: 125,
                leaseDuration: 14.8,
                // Utilities data
                utilitiesData: {
                    electricity: [4000, 3800, 4100, 3900, 4200, 4400, 4600, 4800, 4500, 4300, 4100, 3900],
                    gas: [2100, 2000, 2200, 2100, 2300, 2400, 2500, 2600, 2400, 2300, 2200, 2100],
                    water: [750, 700, 800, 750, 850, 900, 950, 1000, 900, 850, 800, 750],
                    property: [3700, 3500, 3800, 3600, 3900, 4100, 4300, 4500, 4200, 4000, 3800, 3600]
                }
            },
            // Mainland China building - 1 building
            "building-d": {
                name: "Building D - Beijing A",
                location: "Beijing, China",
                region: "mainland",
                coordinates: [39.9042, 116.4074],
                energyOptimization: 2200,
                energySaving: 18500.25,
                // YoY data fields
                revenueChange: 3.2,
                profitChange: -35000,
                occupancyChange: 0.8,
                newLeadsChange: 48,
                // Operations data
                revenue: 520000,
                profit: 280000,
                nps: 89,
                occupancy: 93.5,
                // Rental income data
                incomeData: [400000, 410000, 420000, 430000, 440000, 450000, 460000, 470000, 480000, 490000, 500000, 510000],
                // Operation cost data
                costData: [110000, 120000, 130000, 140000, 150000, 160000, 170000, 180000, 190000, 200000, 210000, 220000],
                // Occupancy data
                occupancyData: { occupied: 93, vacant: 7 },
                // Monthly rentals
                rentedByMonth: [7, 8, 8, 8, 9, 8, 8, 8, 8, 8, 8, 8],
                availableByMonth: [1, 1, 3, 3, 2, 3, 3, 4, 3, 3, 3, 3],
                // Renewed contracts
                renewedContracts: [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25],
                // Property types
                propertyTypes: [
                    { name: "Big Studio", rented: 360, total: 370, percentage: 97.3 },
                    { name: "Middle Studio", rented: 250, total: 360, percentage: 69.4 },
                    { name: "Smaller Studio", rented: 170, total: 290, percentage: 58.6 },
                    { name: "3 Bed Apartment", rented: 350, total: 385, percentage: 90.9 },
                    { name: "2 Bed Apartment", rented: 195, total: 210, percentage: 92.9 },
                    { name: "1 Bed Apartment", rented: 345, total: 345, percentage: 100 }
                ],
                // Expiring leases
                expiringLeases: [
                    { value: "$145,000", label: "< 30 Days", units: 10 },
                    { value: "$275,000", label: "31-70 Days", units: 18 },
                    { value: "$350,000", label: "61-90 Days", units: 22 }
                ],
                // Expiring leases chart
                expiringLeasesChart: [
                    { value: 10, label: "< 30 Days", color: '#4da8da', cost: 145000 },
                    { value: 18, label: "31-70 Days", color: '#2980b9', cost: 275000 },
                    { value: 22, label: "61-90 Days", color: '#1c6ea4', cost: 350000 }
                ],
                newLeads: 175,
                leaseDuration: 16.8,
                // Utilities data
                utilitiesData: {
                    electricity: [4500, 4300, 4600, 4400, 4800, 5000, 5200, 5400, 5100, 4900, 4700, 4500],
                    gas: [2300, 2200, 2400, 2300, 2500, 2600, 2700, 2800, 2600, 2500, 2400, 2300],
                    water: [850, 800, 900, 850, 950, 1000, 1050, 1100, 1000, 950, 900, 850],
                    property: [4000, 3800, 4100, 3900, 4200, 4400, 4600, 4800, 4500, 4300, 4100, 3900]
                }
            },
            // Europe building - 1 building
            "building-e": {
                name: "Building E - London A",
                location: "London, UK",
                region: "europe",
                coordinates: [51.5074, -0.1278],
                energyOptimization: 1600,
                energySaving: 13200.80,
                // YoY data fields
                revenueChange: 2.8,
                profitChange: -32000,
                occupancyChange: 0.3,
                newLeadsChange: 42,
                // Operations data
                revenue: 480000,
                profit: 260000,
                nps: 88,
                occupancy: 91.5,
                // Rental income data
                incomeData: [370000, 360000, 380000, 390000, 400000, 410000, 420000, 430000, 420000, 410000, 400000, 390000],
                // Operation cost data
                costData: [100000, 110000, 120000, 130000, 140000, 150000, 160000, 170000, 180000, 190000, 200000, 210000],
                // Occupancy data
                occupancyData: { occupied: 92, vacant: 8 },
                // Monthly rentals
                rentedByMonth: [6, 7, 7, 7, 8, 7, 7, 7, 7, 7, 7, 7],
                availableByMonth: [2, 2, 4, 4, 3, 4, 4, 5, 4, 4, 4, 4],
                // Renewed contracts
                renewedContracts: [12, 11, 13, 14, 15, 16, 17, 18, 17, 16, 15, 14],
                // Property types
                propertyTypes: [
                    { name: "Big Studio", rented: 340, total: 350, percentage: 97.1 },
                    { name: "Middle Studio", rented: 230, total: 340, percentage: 67.6 },
                    { name: "Smaller Studio", rented: 155, total: 275, percentage: 56.4 },
                    { name: "3 Bed Apartment", rented: 335, total: 370, percentage: 90.5 },
                    { name: "2 Bed Apartment", rented: 185, total: 195, percentage: 94.9 },
                    { name: "1 Bed Apartment", rented: 325, total: 325, percentage: 100 }
                ],
                // Expiring leases
                expiringLeases: [
                    { value: "$130,000", label: "< 30 Days", units: 8 },
                    { value: "$250,000", label: "31-70 Days", units: 16 },
                    { value: "$325,000", label: "61-90 Days", units: 21 }
                ],
                // Expiring leases chart
                expiringLeasesChart: [
                    { value: 8, label: "< 30 Days", color: '#4da8da', cost: 130000 },
                    { value: 16, label: "31-70 Days", color: '#2980b9', cost: 250000 },
                    { value: 21, label: "61-90 Days", color: '#1c6ea4', cost: 325000 }
                ],
                newLeads: 155,
                leaseDuration: 15.9,
                // Utilities data
                utilitiesData: {
                    electricity: [4200, 4000, 4300, 4100, 4400, 4600, 4800, 5000, 4700, 4500, 4300, 4100],
                    gas: [2200, 2100, 2300, 2200, 2400, 2500, 2600, 2700, 2500, 2400, 2300, 2200],
                    water: [800, 750, 850, 800, 900, 950, 1000, 1050, 950, 900, 850, 800],
                    property: [3800, 3600, 3900, 3700, 4000, 4200, 4400, 4600, 4300, 4100, 3900, 3700]
                }
            },
            // USA building - 1 building
            "building-f": {
                name: "Building F - New York A",
                location: "New York, USA",
                region: "usa",
                coordinates: [40.7128, -74.0060],
                energyOptimization: 2400,
                energySaving: 19800.60,
                // YoY data fields
                revenueChange: 3.5,
                profitChange: -25000,
                occupancyChange: 1.0,
                newLeadsChange: 50,
                // Operations data
                revenue: 550000,
                profit: 300000,
                nps: 92,
                occupancy: 94.8,
                // Rental income data
                incomeData: [420000, 430000, 440000, 450000, 460000, 470000, 480000, 490000, 500000, 510000, 520000, 530000],
                // Operation cost data
                costData: [115000, 125000, 135000, 145000, 155000, 165000, 175000, 185000, 195000, 205000, 215000, 225000],
                // Occupancy data
                occupancyData: { occupied: 95, vacant: 5 },
                // Monthly rentals
                rentedByMonth: [7, 8, 8, 8, 9, 8, 8, 8, 8, 8, 8, 8],
                availableByMonth: [1, 1, 3, 3, 2, 3, 3, 4, 3, 3, 3, 3],
                // Renewed contracts
                renewedContracts: [15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26],
                // Property types
                propertyTypes: [
                    { name: "Big Studio", rented: 370, total: 380, percentage: 97.4 },
                    { name: "Middle Studio", rented: 260, total: 370, percentage: 70.3 },
                    { name: "Smaller Studio", rented: 175, total: 300, percentage: 58.3 },
                    { name: "3 Bed Apartment", rented: 360, total: 395, percentage: 91.1 },
                    { name: "2 Bed Apartment", rented: 200, total: 215, percentage: 93.0 },
                    { name: "1 Bed Apartment", rented: 350, total: 350, percentage: 100 }
                ],
                // Expiring leases
                expiringLeases: [
                    { value: "$155,000", label: "< 30 Days", units: 11 },
                    { value: "$285,000", label: "31-70 Days", units: 19 },
                    { value: "$365,000", label: "61-90 Days", units: 22 }
                ],
                // Expiring leases chart
                expiringLeasesChart: [
                    { value: 11, label: "< 30 Days", color: '#4da8da', cost: 155000 },
                    { value: 19, label: "31-70 Days", color: '#2980b9', cost: 285000 },
                    { value: 22, label: "61-90 Days", color: '#1c6ea4', cost: 365000 }
                ],
                newLeads: 185,
                leaseDuration: 17.2,
                // Utilities data
                utilitiesData: {
                    electricity: [4800, 4600, 4900, 4700, 5000, 5200, 5400, 5600, 5300, 5100, 4900, 4700],
                    gas: [2400, 2300, 2500, 2400, 2600, 2700, 2800, 2900, 2700, 2600, 2500, 2400],
                    water: [900, 850, 950, 900, 1000, 1050, 1100, 1150, 1050, 1000, 950, 900],
                    property: [4200, 4000, 4300, 4100, 4400, 4600, 4800, 5000, 4700, 4500, 4300, 4100]
                }
            }
        };

        // Lease expiry timeline table data
        const leaseExpiryData = [
            { name: "Jerry Mattedi", orderDate: "19 May, 2024: 10:10 AM", phone: "251-661-5362", location: "New York", registered: "Yes" },
            { name: "Ellanora Vasilov", orderDate: "18 May, 2024 : 3:12 PM", phone: "171-534-1262", location: "Ontario", registered: "No" },
            { name: "Alvis Daen", orderDate: "17 May, 2023 : 2:15 PM", phone: "974-661-5110", location: "Milan", registered: "Yes" },
            { name: "Lissa Shipsey", orderDate: "23 Apr, 2023 : 1:15 PM", phone: "541-661-3042", location: "San Francisco", registered: "Yes" },
            { name: "John Smith", orderDate: "15 Jun, 2024: 9:30 AM", phone: "555-123-4567", location: "Chicago", registered: "Yes" },
            { name: "Emma Johnson", orderDate: "12 Jul, 2024: 2:45 PM", phone: "555-987-6543", location: "Miami", registered: "No" },
            { name: "Michael Brown", orderDate: "10 Aug, 2024: 11:20 AM", phone: "555-456-7890", location: "Seattle", registered: "Yes" },
            { name: "Sarah Davis", orderDate: "05 Sep, 2024: 4:15 PM", phone: "555-789-0123", location: "Boston", registered: "Yes" },
            { name: "Robert Wilson", orderDate: "28 Oct, 2024: 1:30 PM", phone: "555-234-5678", location: "Austin", registered: "No" },
            { name: "Jennifer Taylor", orderDate: "20 Nov, 2024: 10:00 AM", phone: "555-876-5432", location: "Denver", registered: "Yes" },
            { name: "William Anderson", orderDate: "15 Dec, 2024: 3:45 PM", phone: "555-345-6789", location: "Portland", registered: "Yes" },
            { name: "Linda Martinez", orderDate: "08 Jan, 2025: 9:15 AM", phone: "555-654-3210", location: "Phoenix", registered: "No" },
            { name: "David Thompson", orderDate: "30 Jan, 2025: 2:30 PM", phone: "555-789-4561", location: "Las Vegas", registered: "Yes" },
            { name: "Patricia Garcia", orderDate: "22 Feb, 2025: 11:45 AM", phone: "555-321-9876", location: "Atlanta", registered: "Yes" },
            { name: "Richard Miller", orderDate: "15 Mar, 2025: 4:20 PM", phone: "555-654-9871", location: "Detroit", registered: "No" },
            { name: "Jessica Davis", orderDate: "08 Apr, 2025: 10:10 AM", phone: "555-987-3214", location: "Houston", registered: "Yes" },
            { name: "Thomas Wilson", orderDate: "01 May, 2025: 3:15 PM", phone: "555-741-8529", location: "Philadelphia", registered: "Yes" },
            { name: "Susan Moore", orderDate: "24 May, 2025: 1:45 PM", phone: "555-963-2587", location: "San Diego", registered: "No" },
            { name: "Charles Taylor", orderDate: "17 Jun, 2025: 9:30 AM", phone: "555-852-7419", location: "Dallas", registered: "Yes" },
            { name: "Karen Clark", orderDate: "10 Jul, 2025: 2:00 PM", phone: "555-369-2581", location: "San Jose", registered: "Yes" }
        ];

        // Global variables
        let map;
        let markers = {};
        let currentPage = 1;
        const itemsPerPage = 4;
        let selectedBuildings = new Set();
        let charts = {};
        let currentRegion = 'all';
        let regionChangeInProgress = false;

        document.addEventListener('DOMContentLoaded', function() {
            const addChartBtn = document.getElementById('add-chart-btn');
            const chartModal = document.getElementById('chart-modal');
            const closeModal = document.getElementById('close-modal');
            const cancelModal = document.getElementById('cancel-modal');
            const addChartModal = document.getElementById('add-chart-modal');
            const chartOptions = document.querySelectorAll('.chart-option');
            const chartTitleInput = document.getElementById('chart-title');
            const customChartsGrid = document.getElementById('custom-charts-grid');
            
            let selectedChartType = null;
            
            addChartBtn.addEventListener('click', function() {
                chartModal.classList.add('active');
                selectedChartType = null;
                chartTitleInput.value = '';
                chartOptions.forEach(option => option.classList.remove('selected'));
            });
            
            function closeChartModal() {
                chartModal.classList.remove('active');
            }
            
            closeModal.addEventListener('click', closeChartModal);
            cancelModal.addEventListener('click', closeChartModal);
            
            chartOptions.forEach(option => {
                option.addEventListener('click', function() {
                    chartOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedChartType = this.dataset.type;
                });
            });
            
            addChartModal.addEventListener('click', function() {
                if (!selectedChartType) {
                    alert('Please select a chart type');
                    return;
                }
                
                const chartTitle = chartTitleInput.value.trim();
                if (!chartTitle) {
                    alert('Please enter a chart title');
                    return;
                }
                
                const chartId = 'custom-chart-' + Date.now();
                let chartElement;
                
                switch(selectedChartType) {
                    case 'bar':
                        chartElement = createBarChart(chartId, chartTitle);
                        break;
                    case 'pie':
                        chartElement = createPieChart(chartId, chartTitle);
                        break;
                    case 'number':
                        chartElement = createNumberDisplay(chartId, chartTitle);
                        break;
                }
                
                customChartsGrid.appendChild(chartElement);
                
                closeChartModal();
                
                initSortable();
            });
            
            function createBarChart(id, title) {
                const chartCard = document.createElement('div');
                chartCard.className = 'chart-card';
                chartCard.id = id;
                
                chartCard.innerHTML = `
                    <div class="chart-title">
                        <i class="fas fa-chart-bar"></i> ${title}
                        <button class="delete-chart" data-chart="${id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <div class="chart-container">
                        <canvas id="${id}-canvas"></canvas>
                    </div>
                `;
                
                chartCard.querySelector('.delete-chart').addEventListener('click', function() {
                    chartCard.remove();
                    if (charts[id]) {
                        delete charts[id];
                    }
                });
                
                setTimeout(() => {
                    const ctx = document.getElementById(`${id}-canvas`).getContext('2d');
                    const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'June', 'July', 'Aug', 'Sept', 'Oct', 'Nov', 'Dec'];
                    
                    const data = Array.from({length: 12}, () => Math.floor(Math.random() * 100) + 20);
                    
                    charts[id] = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: months,
                            datasets: [{
                                label: 'Custom Data',
                                data: data,
                                backgroundColor: '#4da8da',
                                borderColor: '#4da8da',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                }, 100);
                
                return chartCard;
            }
            
            function createPieChart(id, title) {
                const chartCard = document.createElement('div');
                chartCard.className = 'chart-card';
                chartCard.id = id;
                
                chartCard.innerHTML = `
                    <div class="chart-title">
                        <i class="fas fa-chart-pie"></i> ${title}
                        <button class="delete-chart" data-chart="${id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <div class="chart-container">
                        <canvas id="${id}-canvas"></canvas>
                    </div>
                `;
                
                chartCard.querySelector('.delete-chart').addEventListener('click', function() {
                    chartCard.remove();
                    if (charts[id]) {
                        delete charts[id];
                    }
                });
                
                setTimeout(() => {
                    const ctx = document.getElementById(`${id}-canvas`).getContext('2d');
                    
                    charts[id] = new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: ['Category A', 'Category B', 'Category C', 'Category D'],
                            datasets: [{
                                data: [30, 25, 20, 25],
                                backgroundColor: [
                                    '#4da8da',
                                    '#2980b9',
                                    '#1c6ea4',
                                    '#90a4ae'
                                ],
                                borderWidth: 0
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                }
                            }
                        }
                    });
                }, 100);
                
                return chartCard;
            }
            
            function createNumberDisplay(id, title) {
                const chartCard = document.createElement('div');
                chartCard.className = 'card';
                chartCard.id = id;
                
                const value = Math.floor(Math.random() * 10000) + 1000;
                const change = (Math.random() * 20 - 10).toFixed(2);
                const isPositive = change >= 0;
                
                chartCard.innerHTML = `
                    <h3><i class="fas fa-hashtag"></i> ${title}</h3>
                    <div class="metric-large">${value.toLocaleString()}</div>
                    <div class="metric-change ${isPositive ? 'positive' : 'negative'}">
                        ${isPositive ? '+' : ''}${change}%
                    </div>
                    <button class="delete-chart" data-chart="${id}">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                
                chartCard.querySelector('.delete-chart').addEventListener('click', function() {
                    chartCard.remove();
                });
                
                return chartCard;
            }
            
            function initSortable() {
                const operationsContainer = document.getElementById('operations-container');
                
                if (operationsContainer.sortable) {
                    operationsContainer.sortable.destroy();
                }
                
                operationsContainer.sortable = new Sortable(operationsContainer, {
                    animation: 150,
                    ghostClass: 'sortable-ghost',
                    dragClass: 'sortable-drag',
                    handle: '.card, .chart-card, .top-right-card, .utilities-chart, .energy-card',
                    filter: '.ignore-elements',
                    preventOnFilter: true,
                    forceFallback: false,
                    fallbackTolerance: 3,
                    scroll: true,
                    scrollSensitivity: 30,
                    scrollSpeed: 10,
                    
                    onEnd: function (evt) {
                        console.log(' ' + evt.oldIndex + '  ' + evt.newIndex);
                        saveLayout();
                    }
                });
                
                const nestedContainers = [
                    document.getElementById('dashboard'),
                    document.getElementById('top-charts-row'),
                    document.getElementById('top-right-cards'),
                    document.getElementById('bottom-charts-grid'),
                    document.getElementById('utilities-energy-section'),
                    document.getElementById('energy-cards'),
                    document.getElementById('custom-charts-grid')
                ];
                
                nestedContainers.forEach(container => {
                    if (container) {
                        if (container.sortable) {
                            container.sortable.destroy();
                        }
                        
                        container.sortable = new Sortable(container, {
                            group: {
                                name: 'nested',
                                pull: true,
                                put: true
                            },
                            animation: 150,
                            ghostClass: 'sortable-ghost',
                            dragClass: 'sortable-drag',
                            handle: '.card, .chart-card, .top-right-card, .utilities-chart, .energy-card',
                            filter: '.ignore-elements',
                            preventOnFilter: true,
                            forceFallback: false,
                            fallbackTolerance: 3,
                            scroll: true,
                            scrollSensitivity: 30,
                            scrollSpeed: 10,
                            
                            onEnd: function (evt) {
                                console.log(' ' + evt.oldIndex + '  ' + evt.newIndex);
                                saveLayout();
                            }
                        });
                    }
                });
            }
            
            function saveLayout() {
                const layout = Array.from(operationsContainer.children).map(child => child.id);
                localStorage.setItem('dashboardLayout', JSON.stringify(layout));
            }
            
            function loadLayout() {
                const savedLayout = localStorage.getItem('dashboardLayout');
                if (savedLayout) {
                    const layout = JSON.parse(savedLayout);
                    layout.forEach(id => {
                        const element = document.getElementById(id);
                        if (element) {
                            operationsContainer.appendChild(element);
                        }
                    });
                }
            }
            
            const operationsContainer = document.getElementById('operations-container');
            
            operationsContainer.sortable = new Sortable(operationsContainer, {
                animation: 150,
                ghostClass: 'sortable-ghost',
                dragClass: 'sortable-drag',
                handle: '.card, .chart-card, .top-right-card, .utilities-chart, .energy-card',
                filter: '.ignore-elements',
                preventOnFilter: true,
                forceFallback: false,
                fallbackTolerance: 3,
                scroll: true,
                scrollSensitivity: 30,
                scrollSpeed: 10,

                onEnd: function (evt) {
                    console.log(' ' + evt.oldIndex + '  ' + evt.newIndex);
                    saveLayout();
                }
            });

            const nestedContainers = [
                document.getElementById('dashboard'),
                document.getElementById('top-charts-row'),
                document.getElementById('top-right-cards'),
                document.getElementById('bottom-charts-grid'),
                document.getElementById('utilities-energy-section'),
                document.getElementById('energy-cards'),
                document.getElementById('custom-charts-grid')
            ];

            nestedContainers.forEach(container => {
                if (container) {
                    container.sortable = new Sortable(container, {
                        group: {
                            name: 'nested',
                            pull: true,
                            put: true
                        },
                        animation: 150,
                        ghostClass: 'sortable-ghost',
                        dragClass: 'sortable-drag',
                        handle: '.card, .chart-card, .top-right-card, .utilities-chart, .energy-card',
                        filter: '.ignore-elements',
                        preventOnFilter: true,
                        forceFallback: false,
                        fallbackTolerance: 3,
                        scroll: true,
                        scrollSensitivity: 30,
                        scrollSpeed: 10,

                        onEnd: function (evt) {
                            console.log(' ' + evt.oldIndex + '  ' + evt.newIndex);
                            saveLayout();
                        }
                    });
                }
            });

            loadLayout();
        });

        function initMap() {
            map = L.map('map').setView([30, 0], 2);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            Object.keys(buildingData).forEach(buildingId => {
                const building = buildingData[buildingId];
                
                const marker = L.circleMarker(building.coordinates, {
                    radius: 8,
                    fillColor: '#3498db',
                    color: '#3498db',
                    weight: 1,
                    opacity: 0.7,
                    fillOpacity: 0.7
                }).addTo(map);
                
                marker.bindPopup(`<b>${building.name}</b><br>${building.location}`);
                
                markers[buildingId] = marker;
                
                marker.on('click', function() {
                    const checkbox = document.querySelector(`.building-checkbox[data-building="${buildingId}"]`);
                    if (checkbox) {
                        checkbox.checked = !checkbox.checked;
                        checkbox.dispatchEvent(new Event('change'));
                    }
                });
            });
            
            document.getElementById('region-select').addEventListener('change', function() {
                currentRegion = this.value;
                regionChangeInProgress = true;
                filterBuildingsByRegion(currentRegion);
                
                // Reset regionChangeInProgress after a short delay
                setTimeout(() => {
                    regionChangeInProgress = false;
                }, 1000);
            });
        }

        function filterBuildingsByRegion(region) {
            updateBuildingList(region);
            updateMapMarkers(region);
            updateDashboardData();
        }

        function updateMapMarkers(region) {
            Object.keys(markers).forEach(buildingId => {
                const building = buildingData[buildingId];
                const marker = markers[buildingId];
                
                if (region === 'all' || building.region === region) {
                    marker.setStyle({
                        opacity: 0.7,
                        fillOpacity: 0.7
                    });
                    
                    if (selectedBuildings.has(buildingId)) {
                        marker.setStyle({
                            fillColor: '#1a3c6e',
                            color: '#1a3c6e',
                            weight: 2,
                            opacity: 1,
                            fillOpacity: 0.7
                        });
                    }
                } else {
                    marker.setStyle({
                        opacity: 0,
                        fillOpacity: 0
                    });
                }
            });
            
            if (region !== 'all' && regionCenters[region]) {
                const center = regionCenters[region];
                map.setView(center.center, center.zoom);
            } else {
                map.setView([30, 0], 2);
            }
        }

        function initBuildingList() {
            updateBuildingList('all');
        }

        function updateBuildingList(region) {
            const container = document.getElementById('building-list-container');
            const totalBuildings = document.getElementById('total-buildings');
            const selectedCount = document.getElementById('selected-count');

            container.innerHTML = '';

            let buildingCount = 0;

            Object.keys(buildingData).forEach(buildingId => {
                const building = buildingData[buildingId];
                
                if (region !== 'all' && building.region !== region) {
                    return;
                }
                
                buildingCount++;
                
                const buildingItem = document.createElement('div');
                buildingItem.className = 'building-item';
                const isSelected = selectedBuildings.has(buildingId);
                buildingItem.innerHTML = `
                    <input type="checkbox" class="building-checkbox" data-building="${buildingId}" ${isSelected ? 'checked' : ''}>
                    <div class="building-info">
                        <div class="building-name">${building.name}</div>
                        <div class="building-location">${building.location}</div>
                    </div>
                `;
                if (isSelected) {
                    buildingItem.classList.add('selected');
                }
                container.appendChild(buildingItem);
                
                const checkbox = buildingItem.querySelector('.building-checkbox');
                checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        selectedBuildings.add(buildingId);
                        buildingItem.classList.add('selected');
                        
                        if (markers[buildingId]) {
                            markers[buildingId].setStyle({
                                fillColor: '#1a3c6e',
                                color: '#1a3c6e',
                                weight: 2,
                                opacity: 1,
                                fillOpacity: 0.7
                            });
                            
                            const popup = markers[buildingId].getPopup();
                            markers[buildingId].openPopup();
                            
                            setTimeout(() => {
                                const popupElement = document.querySelector('.leaflet-popup');
                                if (popupElement) {
                                    popupElement.classList.add('fade-out');
                                    setTimeout(() => {
                                        markers[buildingId].closePopup();
                                    }, 2000);
                                }
                            }, 1000);
                            
                        }
                    } else {
                        selectedBuildings.delete(buildingId);
                        buildingItem.classList.remove('selected');
                        
                        if (markers[buildingId]) {
                            markers[buildingId].setStyle({
                                fillColor: '#3498db',
                                color: '#3498db',
                                weight: 1,
                                opacity: 0.7,
                                fillOpacity: 0.7
                            });
                        }
                    }
                    
                    // Update selected count
                    selectedCount.textContent = `${selectedBuildings.size} building${selectedBuildings.size !== 1 ? 's' : ''} selected`;
                    updateDashboardData();
                });
                
                buildingItem.addEventListener('click', function(e) {
                    if (e.target !== checkbox) {
                        checkbox.checked = !checkbox.checked;
                        checkbox.dispatchEvent(new Event('change'));
                    }
                });
            });

            totalBuildings.textContent = `${buildingCount} buildings`;
            selectedCount.textContent = `${selectedBuildings.size} building${selectedBuildings.size !== 1 ? 's' : ''} selected`;
        }

        function initLeaseTable() {
            const tableBody = document.getElementById('lease-table-body');
            const paginationContainer = document.getElementById('pagination-controls');
            
            const totalPages = Math.ceil(leaseExpiryData.length / itemsPerPage);
            
            updatePagination(totalPages);
            
            updateTableData(1);
            
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('page-btn')) {
                    const page = parseInt(e.target.dataset.page);
                    if (page && page >= 1 && page <= totalPages) {
                        updateTableData(page);
                        updatePagination(totalPages, page);
                        currentPage = page;
                    }
                } else if (e.target.id === 'prev-page') {
                    if (currentPage > 1) {
                        updateTableData(currentPage - 1);
                        updatePagination(totalPages, currentPage - 1);
                        currentPage--;
                    }
                } else if (e.target.id === 'next-page') {
                    if (currentPage < totalPages) {
                        updateTableData(currentPage + 1);
                        updatePagination(totalPages, currentPage + 1);
                        currentPage++;
                    }
                }
            });
            
            function updateTableData(page) {
                const tableBody = document.getElementById('lease-table-body');
                tableBody.innerHTML = '';
                
                const startIndex = (page - 1) * itemsPerPage;
                const endIndex = Math.min(startIndex + itemsPerPage, leaseExpiryData.length);
                
                for (let i = startIndex; i < endIndex; i++) {
                    const lease = leaseExpiryData[i];
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${lease.name}</td>
                        <td>${lease.orderDate}</td>
                        <td>${lease.phone}</td>
                        <td>${lease.location}</td>
                        <td>${lease.registered}</td>
                        <td class="action-buttons">
                            <button class="btn btn-options">Options</button>
                            <button class="btn btn-details">Details</button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                }
            }
            
            function updatePagination(totalPages, currentPage = 1) {
                const paginationContainer = document.getElementById('pagination-controls');
                paginationContainer.innerHTML = '';
                
                const prevButton = document.createElement('button');
                prevButton.id = 'prev-page';
                prevButton.innerHTML = '&laquo;';
                prevButton.disabled = currentPage === 1;
                paginationContainer.appendChild(prevButton);
                
                for (let i = 1; i <= totalPages; i++) {
                    const pageButton = document.createElement('button');
                    pageButton.className = 'page-btn';
                    pageButton.dataset.page = i;
                    pageButton.textContent = i;
                    if (i === currentPage) {
                        pageButton.classList.add('active');
                    }
                    paginationContainer.appendChild(pageButton);
                }
                
                const nextButton = document.createElement('button');
                nextButton.id = 'next-page';
                nextButton.innerHTML = '&raquo;';
                nextButton.disabled = currentPage === totalPages;
                paginationContainer.appendChild(nextButton);
            }
        }

        function updateDashboardData() {
            if (selectedBuildings.size === 0) {
                resetDashboardData();
                return;
            }
            
            let totalRevenue = 0;
            let totalProfit = 0;
            let totalNps = 0;
            let totalOccupancy = 0;
            let totalNewLeads = 0;
            let totalLeaseDuration = 0;
            let totalEnergyOptimization = 0;
            let totalEnergySaving = 0;
            
            let totalRevenueChange = 0;
            let totalProfitChange = 0;
            let totalOccupancyChange = 0;
            let totalNewLeadsChange = 0;
            
            let incomeData = new Array(12).fill(0);
            let costData = new Array(12).fill(0);
            let renewedContractsData = new Array(12).fill(0);
            let rentedByMonthData = new Array(12).fill(0);
            let availableByMonthData = new Array(12).fill(0);
            let propertyTypesData = {
                "Big Studio": { rented: 0, total: 0 },
                "Middle Studio": { rented: 0, total: 0 },
                "Smaller Studio": { rented: 0, total: 0 },
                "3 Bed Apartment": { rented: 0, total: 0 },
                "2 Bed Apartment": { rented: 0, total: 0 },
                "1 Bed Apartment": { rented: 0, total: 0 }
            };
            let expiringLeasesData = [0, 0, 0];
            let expiringLeasesCostData = [0, 0, 0];
            let utilitiesData = {
                electricity: new Array(12).fill(0),
                gas: new Array(12).fill(0),
                water: new Array(12).fill(0),
                property: new Array(12).fill(0)
            };
            
            selectedBuildings.forEach(buildingId => {
                const building = buildingData[buildingId];
                
                totalRevenue += building.revenue;
                totalProfit += building.profit;
                totalNps += building.nps;
                totalOccupancy += building.occupancy;
                totalNewLeads += building.newLeads;
                totalLeaseDuration += building.leaseDuration;
                totalEnergyOptimization += building.energyOptimization;
                totalEnergySaving += building.energySaving;
                
                totalRevenueChange += building.revenueChange;
                totalProfitChange += building.profitChange;
                totalOccupancyChange += building.occupancyChange;
                totalNewLeadsChange += building.newLeadsChange;
                
                for (let i = 0; i < 12; i++) {
                    incomeData[i] += building.incomeData[i];
                    costData[i] += building.costData[i];
                    renewedContractsData[i] += building.renewedContracts[i];
                    rentedByMonthData[i] += building.rentedByMonth[i];
                    availableByMonthData[i] += building.availableByMonth[i];
                    utilitiesData.electricity[i] += building.utilitiesData.electricity[i];
                    utilitiesData.gas[i] += building.utilitiesData.gas[i];
                    utilitiesData.water[i] += building.utilitiesData.water[i];
                    utilitiesData.property[i] += building.utilitiesData.property[i];
                }
                
                building.propertyTypes.forEach((type, index) => {
                    const typeName = Object.keys(propertyTypesData)[index];
                    propertyTypesData[typeName].rented += type.rented;
                    propertyTypesData[typeName].total += type.total;
                });
                
                for (let i = 0; i < 3; i++) {
                    expiringLeasesData[i] += building.expiringLeasesChart[i].value;
                    expiringLeasesCostData[i] += building.expiringLeasesChart[i].cost;
                }
            });
            
            const buildingCount = selectedBuildings.size;
            totalNps = Math.round(totalNps / buildingCount);
            totalOccupancy = Math.round(totalOccupancy / buildingCount);
            totalLeaseDuration = Math.round((totalLeaseDuration / buildingCount) * 10) / 10;
            
            const avgRevenueChange = totalRevenueChange / buildingCount;
            const avgOccupancyChange = totalOccupancyChange / buildingCount;
            
            document.getElementById('revenue-value').textContent = `$${(totalRevenue / 1000).toFixed(0)}K`;
            document.getElementById('profit-value').textContent = `$${(totalProfit / 1000).toFixed(0)}K`;
            document.getElementById('nps-value').textContent = totalNps;
            document.getElementById('occupancy-value').textContent = `${totalOccupancy}%`;
            document.getElementById('new-leads').textContent = totalNewLeads;
            document.getElementById('lease-duration').textContent = `${totalLeaseDuration} months`;
            document.getElementById('energy-optimization').textContent = `${totalEnergyOptimization} kWh`;
            document.getElementById('energy-saving').textContent = `$ ${totalEnergySaving.toFixed(2)}`;
            document.getElementById('leases-expiring-total').textContent = expiringLeasesData.reduce((a, b) => a + b, 0);
            
            updateYoYDisplay(avgRevenueChange, totalProfitChange, avgOccupancyChange, totalNewLeadsChange);
            
            const expiringLeasesContainer = document.getElementById('expiring-leases');
            expiringLeasesContainer.innerHTML = '';
            
            for (let i = 0; i < 3; i++) {
                const leaseItem = document.createElement('div');
                leaseItem.className = 'lease-item';
                leaseItem.innerHTML = `
                    <div class="lease-value">$${(expiringLeasesCostData[i] / 1000).toFixed(0)}K</div>
                    <div class="lease-label">${buildingData[Array.from(selectedBuildings)[0]].expiringLeasesChart[i].label}</div>
                    <div class="lease-label">${expiringLeasesData[i]} Units</div>
                `;
                expiringLeasesContainer.appendChild(leaseItem);
            }
            
            const propertyTypesContainer = document.getElementById('property-types');
            propertyTypesContainer.innerHTML = '';
            
            Object.keys(propertyTypesData).forEach(typeName => {
                const typeData = propertyTypesData[typeName];
                const percentage = typeData.total > 0 ? Math.round((typeData.rented / typeData.total) * 100) : 0;
                
                const propertyBar = document.createElement('div');
                propertyBar.className = 'property-bar';
                propertyBar.innerHTML = `
                    <div class="property-bar-label">${typeName}</div>
                    <div class="property-bar-chart">
                        <div class="property-bar-fill" style="width: ${percentage}%"></div>
                    </div>
                    <div class="property-bar-values">${typeData.rented}/${typeData.total}</div>
                `;
                propertyTypesContainer.appendChild(propertyBar);
            });
            
            updateChartData('incomeCostChart', {
                'Rental Income': incomeData,
                'Operating Costs': costData
            });
            
            const vacancyValue = 100 - totalOccupancy;
            updateChartData('occupancyChart', {
                'Occupancy': [totalOccupancy],
                'Vacancy': [vacancyValue]
            });
            
            updateChartData('rentedByMonthChart', {
                'Rented': rentedByMonthData,
                'Available': availableByMonthData
            });
            
            updateChartData('renewedChart', {
                'Renewed Contracts': renewedContractsData
            });
            
            updateChartData('leasesExpiringChart', {
                '< 30 Days': [expiringLeasesData[0]],
                '31-70 Days': [expiringLeasesData[1]],
                '61-90 Days': [expiringLeasesData[2]]
            });
            
            updateChartData('npsGaugeChart', {
                'NPS Score': [totalNps],
                'Remaining': [100 - totalNps]
            });
            
            updateChartData('utilitiesChart', {
                'Electricity Bill': utilitiesData.electricity,
                'Gas Bill': utilitiesData.gas,
                'Water Bill': utilitiesData.water,
                'Property Mgmt. Fee': utilitiesData.property
            });
        }
        
        function updateYoYDisplay(avgRevenueChange, totalProfitChange, avgOccupancyChange, totalNewLeadsChange) {

            const revenueChangeElement = document.getElementById('revenue-change');
            revenueChangeElement.textContent = `${avgRevenueChange > 0 ? '+' : ''}${avgRevenueChange.toFixed(3)}% YoY`;
            revenueChangeElement.className = `metric-change ${avgRevenueChange >= 0 ? 'positive' : 'negative'}`;
            
            const profitChangeElement = document.getElementById('profit-change');
            profitChangeElement.textContent = `${totalProfitChange > 0 ? '+' : ''}${Math.round(totalProfitChange).toLocaleString()} YoY`;
            profitChangeElement.className = `metric-change ${totalProfitChange >= 0 ? 'positive' : 'negative'}`;
            
            const occupancyChangeElement = document.getElementById('occupancy-change');
            occupancyChangeElement.textContent = `${avgOccupancyChange > 0 ? '+' : ''}${avgOccupancyChange.toFixed(2)}%`;
            occupancyChangeElement.className = `metric-change ${avgOccupancyChange >= 0 ? 'positive' : 'negative'}`;
            
            const newLeadsChangeElement = document.getElementById('new-leads-change');
            newLeadsChangeElement.textContent = `${totalNewLeadsChange > 0 ? '+' : ''}${Math.round(totalNewLeadsChange)} YoY`;
            newLeadsChangeElement.className = `metric-change ${totalNewLeadsChange >= 0 ? 'positive' : 'negative'}`;
        }
        
        function resetDashboardData() {
            document.getElementById('revenue-value').textContent = '$0';
            document.getElementById('profit-value').textContent = '$0';
            document.getElementById('nps-value').textContent = '0';
            document.getElementById('occupancy-value').textContent = '0%';
            document.getElementById('new-leads').textContent = '0';
            document.getElementById('lease-duration').textContent = '0 months';
            document.getElementById('energy-optimization').textContent = '0 kWh';
            document.getElementById('energy-saving').textContent = '$ 0';
            document.getElementById('leases-expiring-total').textContent = '0';
            
            document.getElementById('revenue-change').textContent = '0% YoY';
            document.getElementById('revenue-change').className = 'metric-change positive';
            
            document.getElementById('profit-change').textContent = '0 YoY';
            document.getElementById('profit-change').className = 'metric-change positive';
            
            document.getElementById('occupancy-change').textContent = '0%';
            document.getElementById('occupancy-change').className = 'metric-change positive';
            
            document.getElementById('new-leads-change').textContent = '0 YoY';
            document.getElementById('new-leads-change').className = 'metric-change positive';
            
            const expiringLeasesContainer = document.getElementById('expiring-leases');
            expiringLeasesContainer.innerHTML = '';
            
            for (let i = 0; i < 3; i++) {
                const leaseItem = document.createElement('div');
                leaseItem.className = 'lease-item';
                leaseItem.innerHTML = `
                    <div class="lease-value">$0</div>
                    <div class="lease-label">${buildingData['building-a'].expiringLeasesChart[i].label}</div>
                    <div class="lease-label">0 Units</div>
                `;
                expiringLeasesContainer.appendChild(leaseItem);
            }
            
            const propertyTypesContainer = document.getElementById('property-types');
            propertyTypesContainer.innerHTML = '';
            
            const sampleBuilding = buildingData['building-a'];
            if (sampleBuilding && sampleBuilding.propertyTypes) {
                sampleBuilding.propertyTypes.forEach(type => {
                    const propertyBar = document.createElement('div');
                    propertyBar.className = 'property-bar';
                    propertyBar.innerHTML = `
                        <div class="property-bar-label">${type.name}</div>
                        <div class="property-bar-chart">
                            <div class="property-bar-fill" style="width: 0%"></div>
                        </div>
                        <div class="property-bar-values">0/0</div>
                    `;
                    propertyTypesContainer.appendChild(propertyBar);
                });
            }
            
            const emptyData = new Array(12).fill(0);
            updateChartData('incomeCostChart', {
                'Rental Income': emptyData,
                'Operating Costs': emptyData
            });
            
            updateChartData('occupancyChart', {
                'Occupancy': [0],
                'Vacancy': [100]
            });
            
            updateChartData('rentedByMonthChart', {
                'Rented': emptyData,
                'Available': emptyData
            });
            
            updateChartData('renewedChart', {
                'Renewed Contracts': emptyData
            });
            
            updateChartData('leasesExpiringChart', {
                '< 30 Days': [0],
                '31-70 Days': [0],
                '61-90 Days': [0]
            });
            
            updateChartData('npsGaugeChart', {
                'NPS Score': [0],
                'Remaining': [100]
            });
            
            updateChartData('utilitiesChart', {
                'Electricity Bill': emptyData,
                'Gas Bill': emptyData,
                'Water Bill': emptyData,
                'Property Mgmt. Fee': emptyData
            });
        }
        
        function updateChartData(chartId, datasets) {
            if (charts[chartId]) {
                const chart = charts[chartId];
                
                if (chart.config.type === 'pie' || chart.config.type === 'doughnut') {
                    const labels = chart.data.labels;
                    const dataArray = labels.map(label => {
                        const key = Object.keys(datasets).find(key => 
                            key.toLowerCase().includes(label.toLowerCase().replace(/\s/g, '')) || 
                            label.toLowerCase().includes(key.toLowerCase().replace(/\s/g, ''))
                        );
                        
                        if (key && datasets[key] !== undefined) {
                            return Array.isArray(datasets[key]) ? datasets[key][0] : datasets[key];
                        }
                        
                        const index = labels.indexOf(label);
                        const values = Object.values(datasets);
                        if (index < values.length) {
                            const val = values[index];
                            return Array.isArray(val) ? val[0] : val;
                        }
                        
                        return 0;
                    });
                    
                    chart.data.datasets[0].data = dataArray;
                } else {
                    Object.keys(datasets).forEach((datasetName, index) => {
                        if (chart.data.datasets[index]) {
                            chart.data.datasets[index].data = datasets[datasetName];
                        }
                    });
                }
                
                chart.update();
            }
        }

        function initOperationsCharts() {
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'June', 'July', 'Aug', 'Sept', 'Oct', 'Nov', 'Dec'];
            const emptyData = new Array(12).fill(0);

            const incomeCostCtx = document.getElementById('incomeCostChart').getContext('2d');
            charts.incomeCostChart = new Chart(incomeCostCtx, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [
                        {
                            label: 'Rental Income',
                            data: emptyData,
                            backgroundColor: '#4da8da',
                            borderColor: '#4da8da',
                            borderWidth: 1
                        },
                        {
                            label: 'Operating Costs',
                            data: emptyData,
                            backgroundColor: '#1c6ea4',
                            borderColor: '#1c6ea4',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Amount ($)'
                            }
                        }
                    }
                }
            });

            const occupancyCtx = document.getElementById('occupancyChart').getContext('2d');
            charts.occupancyChart = new Chart(occupancyCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Occupancy', 'Vacancy'],
                    datasets: [{
                        data: [0, 100],
                        backgroundColor: ['#2980b9', '#90a4ae'], 
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            const rentedByMonthCtx = document.getElementById('rentedByMonthChart').getContext('2d');
            charts.rentedByMonthChart = new Chart(rentedByMonthCtx, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [
                        {
                            label: 'Rented',
                            data: emptyData,
                            backgroundColor: '#2980b9'
                        },
                        {
                            label: 'Available',
                            data: emptyData,
                            backgroundColor: '#90a4ae'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true,
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Properties'
                            }
                        }
                    }
                }
            });

            const renewedCtx = document.getElementById('renewedChart').getContext('2d');
            charts.renewedChart = new Chart(renewedCtx, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Renewed Contracts',
                        data: emptyData,
                        backgroundColor: '#1c6ea4'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Contracts'
                            }
                        }
                    }
                }
            });

            const leasesExpiringCtx = document.getElementById('leasesExpiringChart').getContext('2d');
            charts.leasesExpiringChart = new Chart(leasesExpiringCtx, {
                type: 'doughnut',
                data: {
                    labels: ['< 30 Days', '31-70 Days', '61-90 Days'],
                    datasets: [{
                        data: [33, 33, 34], 
                        backgroundColor: ['#4da8da', '#2980b9', '#1c6ea4'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    circumference: 180,
                    rotation: -90,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    return `${context.label}: ${context.parsed} units`;
                                }
                            }
                        }
                    }
                }
            });

            const npsGaugeCtx = document.getElementById('npsGaugeChart').getContext('2d');

            const gradient = npsGaugeCtx.createLinearGradient(0, 0, 300, 0);
            gradient.addColorStop(0, '#7cb342');
            gradient.addColorStop(0.5, '#f9a825');
            gradient.addColorStop(1, '#e57373');

            charts.npsGaugeChart = new Chart(npsGaugeCtx, {
                type: 'doughnut',
                data: {
                    labels: ['NPS Score', 'Remaining'],
                    datasets: [{
                        data: [50, 50],
                        backgroundColor: [gradient, '#f5f5f5'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    circumference: 180,
                    rotation: -90,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            enabled: false
                        }
                    }
                }
            });

            const utilitiesCtx = document.getElementById('utilitiesChart').getContext('2d');
            charts.utilitiesChart = new Chart(utilitiesCtx, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [
                        {
                            label: 'Electricity Bill',
                            data: emptyData,
                            backgroundColor: '#4da8da',
                            borderColor: '#4da8da',
                            borderWidth: 1
                        },
                        {
                            label: 'Gas Bill',
                            data: emptyData,
                            backgroundColor: '#2980b9',
                            borderColor: '#2980b9',
                            borderWidth: 1
                        },
                        {
                            label: 'Water Bill',
                            data: emptyData,
                            backgroundColor: '#1c6ea4',
                            borderColor: '#1c6ea4',
                            borderWidth: 1
                        },
                        {
                            label: 'Property Mgmt. Fee',
                            data: emptyData,
                            backgroundColor: '#90a4ae',
                            borderColor: '#90a4ae',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true,
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Cost ($)'
                            }
                        }
                    }
                }
            });
        }

        window.onload = function () {
            initMap();
            initOperationsCharts();
            initBuildingList();
            initLeaseTable();
            resetDashboardData(); 
        };
    </script>
</body>
</html>